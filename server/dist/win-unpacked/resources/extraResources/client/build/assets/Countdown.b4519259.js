import{aq as P,ar as U,r as l,aj as S,g as o,j as i,as as q}from"./index.884ef809.js";import{u as O}from"./utils.71c85371.js";import{p as h}from"./index.a719180e.js";import{u as V,m as W,N as z}from"./useRuntimeStylesheet.cce38e2c.js";import{E as B}from"./Empty.a3aa49f7.js";import{a as f,f as G}from"./dateConfig.7f97a25b.js";import"./index.esm.36fc65dd.js";import"./useFullscreen.e5cbfcf7.js";import"./index.641207f5.js";function H(t,e){let r=0,n=0;if(e>=0)for(const s of t){if(e===n)return r;s.type==="delay"?r+=s.duration:s.type==="block"&&(r=0),n++}return 0}const J=t=>t===null||t===""||typeof t>"u"?"{no title}":t,d={toStart:"Time to start",waiting:"Waiting for event start",running:"Event running",ended:"Event ended at"},K=(t,e,r)=>{let n="",s=0;return r===e.id?(n=t.playstate==="pause"?d.waiting:d.running,s=t.running):t.clock<e.timeStart?(n=d.toStart,s=f(e.timeStart-t.clock)):e.timeStart<=t.clock&&t.clock<=e.timeEnd?(n=d.waiting,s=t.running):e.timeStart>e.timeEnd?e.timeStart>t.clock?(n=d.toStart,s=f(e.timeStart-t.clock)):e.timeStart<=t.clock?(n=d.waiting,s=t.running):(n=d.ended,s=f(e.timeEnd)):(n=d.ended,s=f(e.timeEnd)),{message:n,timer:s}};const N={showSeconds:!0,format:"hh:mm:ss a"};function Q(t){const{backstageEvents:e,time:r,selectedId:n,viewSettings:s}=t,{shouldRender:k}=V((s==null?void 0:s.overrideStyles)&&P),[x]=U(),[b]=O(W),[a,$]=l.exports.useState(null),[T,j]=l.exports.useState(0),[y,R]=l.exports.useState(""),[v,D]=l.exports.useState(0);if(l.exports.useEffect(()=>{document.title="ontime - Countdown"},[]),l.exports.useEffect(()=>{if(!e)return;const c=x.get("eventid"),m=x.get("event");let u;const g=[...e].filter(p=>p.type==="event");if(c!==null?u=g.find(p=>p.id===c):m!==null&&(u=g==null?void 0:g[m-1]),typeof u<"u"){$(u);const p=e.findIndex(F=>F.id===u.id),A=H(e,p);D(A)}},[e,x]),l.exports.useEffect(()=>{if(!a)return;const{message:c,timer:m}=K(r,a,n);R(c),j(m)},[a,n,r]),!k)return null;const I=r.playstate!=="start"&&n===(a==null?void 0:a.id),M=r.finished&&y===d.running,_=y===d.running,E=v>0?"aux-timers__value--delayed":"",w=S(r.clock,N),C=a===null?"...":S(a.timeStart+v,N),L=a===null?"...":S(a.timeEnd+v,N);return o("div",{className:`countdown ${b?"mirror":""}`,children:[i(z,{}),a===null?o("div",{className:"event-select",children:[i("span",{className:"event-select__title",children:"Select an event to follow"}),i("ul",{className:"event-select__events",children:e.length===0?i(B,{dark:!0,text:"No events in database"}):e.filter(c=>c.type==="event").map((c,m)=>i("li",{children:i(q,{to:`/countdown?eventid=${c.id}`,children:`${m+1}. ${J(c.title)}`})},c.id))})]}):o("div",{className:"countdown-container",children:[o("div",{className:"timer-group",children:[o("div",{className:"aux-timers",children:[i("div",{className:"aux-timers__label",children:"Time Now"}),i("span",{className:"aux-timers__value",children:w})]}),o("div",{className:"aux-timers",children:[i("div",{className:"aux-timers__label",children:"Start Time"}),i("span",{className:`aux-timers__value ${E}`,children:C})]}),o("div",{className:"aux-timers",children:[i("div",{className:"aux-timers__label",children:"End Time"}),i("span",{className:`aux-timers__value ${E}`,children:L})]})]}),i("div",{className:"status",children:y}),i("span",{className:`timer ${I?"timer--paused":""} ${M?"timer--finished":""}`,children:G(_?T:T+f(v),_||r.waiting)}),i("div",{className:"title",children:(a==null?void 0:a.title)||"Untitled Event"})]})]})}Q.propTypes={backstageEvents:h.exports.array,time:h.exports.object,selectedId:h.exports.string,viewSettings:h.exports.object};export{Q as default};
